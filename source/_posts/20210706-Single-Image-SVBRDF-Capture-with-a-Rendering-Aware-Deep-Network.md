---
title: Single-Image SVBRDF Capture with a Rendering-Aware Deep Network
date: 2021/07/06
tags: 
- graphics
- material
- SVBRDF
categories:
- note
- grpahics
- material
- paper
keywords: graphics-material
hide: true
---

# 背景
材质函数对于真实渲染时至关重要的，希望从一张或少量物体编码的图像中恢复材质的brdf。

这个任务难点的在于这个任务是病态的，因为有多个不同的反射组合可以产生相同结果的图像。

对于病态问题，通常使用两种策略的组合来进行处理
1. 通过在不同的视角和光源条件下进行测量，从而减少歧义。可以得到更加精确的结果但是需要对采集过程进行精准的控制。
2. 通过引入先验假设来缩小解空间，但是认为设计先验条件是困难的。

## Problem

训练神经网络从单张图片中提出物体表面的材质信息。

### difficulty

1. 许多不同的反射属性可以产生相同的结果，产生准确的结果需要许多训练数据。
2. 无法获得足够的材质训练集。

## Contribution

1. 生成大量真实的SVBRDF训练数据
2. 引入了渲染损失来评估预测的外观与真实外观的差异
3. 引入了第二个网络从远处的像素提取全局信息，与局部信息组合，从而合成细节。

## Related Work

[Dror et al. 2001]第一次使用机器学习算法根据图像特征对材质进行分类。

[Li et al. 2017]使用了encoder-decoder架构来估计漫反射参数和法线，对不同的材质训练的不同的网络。

[Liu et al. 2017]引入了rendering loss。

[Aittala et al. 2016]使用了可微分渲染器来比较估计材质的纹理统计和输出图像的纹理统计，在标准的inverse rendering框架中使用。

## Method

网络架构如下图所示

[Network Architecture][../_img/2021-07-06_UNet_Architecture.png]

使用了两个网络，主要原因是，对于单张图片，高光部分可以提供强烈的specularity信息，而其他部分提供了漫反射和法线信息。因此，为了使得到的结果在图片各个部分是一致的，这两部分需要共享信息。但是，现有的encoder-decoder架构无法将收集远距离的信息并传播到细粒度的细节中。因此，需要添加额外的网络来提取全局特征，并与局部特征结合。

### U-Net Network

使用U-Net架构作为网络的基础，大部分实现细节与[Isola et al. 2017]相同。

网络使用三通道的图像作为输出，输出是九通道的图，分别是三通道的漫反射、三通道的高光、两通道的法线（x和y），一通道的粗糙度。

将输入转换到对数空间，并使用公式$\frac {\log(x+0.01) - \log(0.01)} {\log(1.01) - \log(0.01)}$将输入压缩的$[0,1]$范围内。

U-Net的encoder和decoder各有八层，由于网络本身的特点，无法保留图像的细节，因此在对应层之间引入skip connection来缓解这个问题。

在decoder之前，插入一个单个卷积层，输出64特征通道。

编码器下采样的特征数分别为128，256，512，512，512，512，512，512。（这里不明白，在编码器的时候特征数量不应该是逐渐减少的吗？这里应该是通道数，当然到U-Net最低层之后就是特征数）

每层使用的filter是$4\times4$的，对于非线性的，使用leaky ReLu激活函数，负数部分的权重是$-0.2$。最终的输出通过sigmoid函数使得值落在$[0,1]$范围。

在每个卷积层后，应用instance normalization，可以稳定图像生成任务的训练。通过在解码器的三个最粗的层上应用50%概率的放弃来进行规范化。（这里部分不太清楚，需要进一步查资料）

### Global Feature Network

尽管归一化对训练的稳定性有正面影响，但由于归一化会对学习到的特征进行标准化，对保留图像的非局部进行有负面影响，在生成的结果上会存在瑕疵。

即便不使用归一化，生成的结果也存在明显的阴影。

因此，增加一个与U-Net并行的网络来处理全局特征向量，网络的结构UNet相同，特征数量相同，卷积层改为了全连接层，并放弃了skip connection（这里需要的是全局的一些信息，所以不需要skip connection来恢复细节）。

全局网络处理全局特征向量，而不是2维的特征图。

这个网络和主网络在每一层交换信息，具体详情没看明白。

卷积track信息通过实例化归一化层流向全局track信息。

全局track信息在每个卷积之后非线性之前被注入回局部track。先将全局特征通过全连接层转换，将他们像biase一样加到下一层的每个特征图中。

UNet每一层的第一个部分是IN（instance normalize），经过均值之后，与全局特征连接起来，然后通过一个全连接层（FC），之后再通过一个非线性层，再通过一个激活函数后传递到下一层，同时与UNet下一层的IN结果相加。

### Rendering Loss

损失函数是比较生成的SVBRDF的渲染结果与真实SVBRDF的渲染结果的逐像素比较。类似于[Aittala et al. 2016]中的方法，可以与神经网络训练的无缝集成，自动计算的导数，以及自动的GPU加速。

具体的损失函数是使用渲染值的对数的$L_1$ loss。

## Advantage

1. 可以从单张图片中恢复出效果较好的SVBRDF。

## Limited

1. 图像的分辨率是$256 \times 256$
2. 高动态范围的图像学习效果不佳。
3. 在生成的不同图中结构相似。
4. 复杂材质表现不佳。
5. 图片的角度是正向的，不能很好的反映菲涅尔项。
6. 单张图片提供的效果不佳，可能有部分信息无法恢复。

## My Question

1. high dynamic和low dynamic到底是什么，高频低频？
2. 对于网络这一块不熟，看起来有点费劲，需要查询大量资料。

